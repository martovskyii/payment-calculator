<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Калькулятор выплат</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --bg: #0e0f12;
      --card-bg: #1a1c21;
      --text: #f5f5f5;
      --muted: #888;
      --accent: #4da3ff;
      --border: #2a2d33;
      --green: #55d66b;
      --red: #ff5c5c;
    }
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      padding: 24px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 12px;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.4);
      max-width: 520px;
      width: 100%;
      transition: all 0.3s ease;
    }
    .muted {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 12px;
    }
    label {
      display: block;
      font-weight: 500;
      margin-bottom: 6px;
    }
    input[type=number] {
      width: 100%;
      max-width: 240px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #111217;
      color: var(--text);
      outline: none;
      transition: border 0.25s ease, box-shadow 0.25s ease;
    }
    input[type=number]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 6px rgba(77,163,255,0.4);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 14px;
      font-size: 14px;
      animation: fadeIn 0.5s ease forwards;
    }
    th, td {
      border-bottom: 1px solid #2a2d33;
      padding: 8px 6px;
      text-align: left;
    }
    th {
      font-weight: 600;
      font-size: 13px;
      color: var(--muted);
      background: #1d1f25;
    }
    td.right { text-align: right; }
    .big {
      font-weight: 700;
      font-size: 18px;
      margin-top: 10px;
    }
    .ok {
      color: var(--green);
    }
    .fade {
      opacity: 0;
      transform: translateY(15px);
      transition: all 0.4s cubic-bezier(0.4, 0.1, 0.3, 1);
    }
    .fade.show {
      opacity: 1;
      transform: translateY(0);
    }
    .config {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 14px;
    }
    .config input {
      width: 90px;
      text-align: right;
    }
    .config label {
      font-size: 13px;
      color: var(--muted);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 480px) {
      body { padding: 12px; }
      .card { padding: 14px; }
    }
  </style>
</head>
<body>
  <h1>Калькулятор выплат</h1>
  <div class="card">
    <div class="muted">Введите количество поездок. Если меньше 250 — оплата не начисляется.</div>
    <label for="trips">Количество поездок:</label>
    <input id="trips" type="number" min="0" placeholder="например, 380">
    <div class="config">
      <label>Порог: <input id="threshold" type="number" min="0" value="250"></label>
      <label>Вычет (%): <input id="deduct" type="number" min="0" max="100" value="8"></label>
    </div>
    <div id="result" class="fade"></div>
  </div>

  <script>
    const defaultTiers = [
      {start: 1, end: 299, rate: 1.70},
      {start: 300, end: 399, rate: 1.80},
      {start: 400, end: 499, rate: 2.00},
      {start: 500, end: 599, rate: 2.20},
      {start: 600, end: Infinity, rate: 2.50}
    ];

    function format(n) {
      return new Intl.NumberFormat('ru-RU', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(n);
    }

    function calculate(n, threshold, deductionPercent) {
      n = Math.floor(Number(n) || 0);
      if (n < threshold) return {paid: false, total: 0, breakdown: [], after: 0};
      let total = 0;
      const breakdown = [];
      for (const t of defaultTiers) {
        const lower = Math.max(t.start, 1);
        const upper = Math.min(n, t.end);
        if (upper >= lower) {
          const count = upper - lower + 1;
          const sum = count * t.rate;
          total += sum;
          breakdown.push({
            range: (t.end === Infinity ? `${t.start}+` : `${t.start}–${t.end}`),
            count, rate: t.rate, sum
          });
        }
        if (upper === n) break;
      }
      total = Math.round(total * 100) / 100;
      const after = Math.round(total * (1 - deductionPercent / 100) * 100) / 100;
      return {paid: true, total, breakdown, after};
    }

    function render(res, n, threshold, deductionPercent) {
      const div = document.getElementById('result');
      div.classList.remove('show');
      if (!n) { div.innerHTML = ''; return; }
      if (!res.paid) {
        div.innerHTML = `<div class="muted big">Поездок: ${n} — меньше ${threshold}.<br>Оплата не начисляется.</div>`;
        requestAnimationFrame(() => div.classList.add('show'));
        return;
      }
      let html = `<div class="muted">Всего поездок: <b>${n}</b></div>`;
      html += `<table><thead><tr><th>Диапазон</th><th>Кол-во</th><th>Ставка (PLN)</th><th class="right">Сумма (PLN)</th></tr></thead><tbody>`;
      for (const b of res.breakdown) {
        html += `<tr><td>${b.range}</td><td>${b.count}</td><td>${format(b.rate)}</td><td class="right">${format(b.sum)}</td></tr>`;
      }
      html += `</tbody></table>`;
      html += `<div class="big">Общая сумма: <span class="ok">${format(res.total)} PLN</span></div>`;
      html += `<div class="muted">Вычет ${deductionPercent}%: ${format(res.total - res.after)} PLN</div>`;
      html += `<div class="big">Итого после вычета: <span class="ok">${format(res.after)} PLN</span></div>`;
      div.innerHTML = html;
      requestAnimationFrame(() => div.classList.add('show'));
    }

    const trips = document.getElementById('trips');
    const threshold = document.getElementById('threshold');
    const deduct = document.getElementById('deduct');

    function recalc() {
      const n = Number(trips.value);
      const th = Number(threshold.value);
      const ded = Number(deduct.value);
      const res = calculate(n, th, ded);
      render(res, n, th, ded);
    }

    [trips, threshold, deduct].forEach(el => el.addEventListener('input', recalc));
  </script>
</body>
</html>
